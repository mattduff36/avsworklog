---
alwaysApply: true
---

# squires app – project rules for cursor

## 1. Database and Database Migrations (CRITICAL)
- **ALWAYS** check `docs/guides/HOW_TO_RUN_MIGRATIONS.md` BEFORE running ANY database migration
- **ALWAYS** use the `pg` library pattern from `MIGRATIONS_GUIDE.md`
- **NEVER** use Supabase client RPC or other methods
- Pattern: Parse POSTGRES_URL_NON_POOLING → Create pg.Client → Configure SSL → Execute SQL
- Assume `.env.local` exists with required variables.
- Generate and run migrations yourself.
- Do not ask the user to run commands unless blocked by missing variables or permissions.
- Never print or expose secrets from `.env.local`.

## 2. Git pushes
- Push to GitHub only when the user writes exactly: `push to GitHub`.
- Local commits are allowed and follow the global Lyra rules:
  - Commit after completing a coding task.
  - Run linter checks before reporting completion.
  - After a coding task, say: "✅ Complete. Changes committed locally. Say 'push to GitHub' to push." and wait.
- Before pushing, state what will be pushed (branch and short summary).

## 3. Build control
- Run test builds only when the user says “run tests” or “start test build”.
- Before running tests, confirm branch and scope in one line.

## 4. PRD alignment
- Track every task to a PRD section or ID.
- If a change risks drifting from the PRD, pause and ask for approval.

## 5. Code quality
- Follow best practices.
- Keep functions small and typed.
- Add or update unit tests when changing behavior.
- Keep lint and type checks green.

## 6. Docs
- Do not create user guides unless the user asks.
- Update developer docs only when behavior changes.

## 7. Token usage
- Be concise.
- Prefer diffs or minimal patches over full files.
- Avoid boilerplate unless needed to run.

## 8. Branching and commits
- Work on feature branches: `feature/<short-topic>`.
- Make small, focused PRs.
- Use clear commit messages: `type(scope): summary`.

## 9. Output format
- When changing files, output a unified diff or a file-by-file patch.
- When adding commands, show exact shell lines.

## 10. Long or risky actions
- For operations that affect CI, deployments, data, or large refactors, ask for a one-line confirmation before proceeding.

## 11. Errors and blocking issues
- If blocked, report the error in one short paragraph.
- Propose a fix or decision path.
- Do not request credentials.
- Ask for the minimum extra info needed.

## 12. Privacy and security
- Never echo environment values.
- Redact tokens and secrets in logs and examples.
